use liquid::model::{Scalar, Value};
use liquid::{Object, ObjectView, Parser};

////////////////////////////////////////////////////////////////////////////////////////////////////

pub type Error = liquid::Error;

////////////////////////////////////////////////////////////////////////////////////////////////////

pub type TemplateObject = Object;

////////////////////////////////////////////////////////////////////////////////////////////////////

pub type TemplateValue = Value;

////////////////////////////////////////////////////////////////////////////////////////////////////

pub type TemplateScalar = Scalar;

////////////////////////////////////////////////////////////////////////////////////////////////////

#[derive(Default)]
pub struct TemplateEngine {
    parser: Parser,
}

impl TemplateEngine {
    pub fn render<T>(&self, variables: &T, input: &str) -> Result<String, Error>
    where
        T: ObjectView,
    {
        let mut input = String::from(input);

        loop {
            let output = self.parser.parse(&input)?.render(&variables)?;

            if output == input {
                return Ok(output);
            }

            input = output;
        }
    }
}
